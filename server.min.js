const express=require("express"),mongoose=require("mongoose"),app=express(),dotenv=require("dotenv");dotenv.config({path:"./config.env"});const passport=require("passport"),morgan=require("morgan"),ejs=require("ejs"),expressLayouts=require("express-ejs-layouts"),path=require("path"),session=require("express-session"),{Session:Session}=require("inspector"),MongoStore=require("connect-mongo"),connectDB=require("./config/db")(),PORT=process.env.PORT||80;"developement"===process.env.NODE_ENV&&app.use(morgan("dev"));const favicon=require("serve-favicon");app.use(favicon(path.join(__dirname,"favicon.png"))),app.use(express.static(path.join(__dirname,"/public"))),require("./config/passport")(passport),app.use(expressLayouts),app.set("view engine","ejs"),app.set("views",path.join(__dirname,"/views")),app.use(session({secret:"story book",resave:!1,saveUninitialized:!1,store:MongoStore.create({mongoUrl:process.env.MONGO_URI})})),app.use(passport.initialize()),app.use(passport.session()),app.use(express.urlencoded({extended:!1})),app.use(express.json());const router=require("./routes"),auth=require("./routes/auth"),story=require("./routes/story");app.use(router),app.use("/auth",auth),app.use(story),app.use((e,s)=>{s.status(404).render("errors/error404",{layout:"layout2"})}),app.listen(PORT,()=>console.log(`server running in ${process.env.NODE_ENV} mode on port ${PORT}`));